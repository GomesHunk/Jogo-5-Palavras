<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéØ Jogo das 5 Palavras - Multiplayer</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #333;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }

    .section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .section:hover {
      box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    }

    .hidden {
      display: none;
    }

    h1 {
      text-align: center;
      color: #444;
      margin-bottom: 30px;
      font-size: 2.2em;
      font-weight: 700;
    }

    h2 {
      color: #555;
      font-size: 1.4em;
      margin-bottom: 20px;
      font-weight: 600;
    }

    h3 {
      color: #666;
      font-size: 1.2em;
      margin-bottom: 15px;
      font-weight: 600;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      margin-bottom: 15px;
      transition: border-color 0.3s ease;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    button {
      width: 100%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-weight: 600;
      border: none;
      padding: 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s ease;
      margin-bottom: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .word-input {
      margin-bottom: 12px;
    }

    .word-input input {
      margin-bottom: 0;
    }

    .game-info {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }

    .keyword {
      font-size: 1.8em;
      font-weight: 700;
      margin-bottom: 15px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .hints-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .hint-word {
      background: rgba(255,255,255,0.2);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      font-size: 1.1em;
      letter-spacing: 2px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .hint-word.current {
      border-color: #fff;
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .hint-word.completed {
      background: rgba(46, 204, 113, 0.8);
      border-color: #2ecc71;
    }

    .turn-indicator {
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .your-turn {
      color: #2ecc71;
    }

    .opponent-turn {
      color: #e74c3c;
    }

    #chat, #players {
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
      border: 2px solid #f0f0f0;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .chat-message {
      margin-bottom: 8px;
      padding: 8px;
      background: white;
      border-radius: 6px;
      border-left: 3px solid #667eea;
    }

    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin-bottom: 8px;
      background: white;
      border-radius: 6px;
      border-left: 3px solid #95a5a6;
    }

    .player-item.current-turn {
      border-left-color: #2ecc71;
      background: #f8fff9;
    }

    .player-item.words-chosen {
      border-left-color: #3498db;
    }

    .status-indicator {
      font-size: 0.8em;
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 600;
    }

    .status-ready {
      background: #d4edda;
      color: #155724;
    }

    .status-waiting {
      background: #fff3cd;
      color: #856404;
    }

    .status-playing {
      background: #cce5ff;
      color: #004085;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      border: 1px solid #f5c6cb;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      border: 1px solid #c3e6cb;
    }

    .room-code {
      background: #e9ecef;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.1em;
      font-weight: 600;
      color: #495057;
    }

    .game-rules {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 0.9em;
      line-height: 1.6;
    }

    .game-rules h4 {
      color: #495057;
      margin-bottom: 10px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8em;
      }
      
      .hints-container {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 8px;
      }
      
      .hint-word {
        padding: 8px;
        font-size: 1em;
      }
      
      .keyword {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Jogo das 5 Palavras</h1>

    <!-- Se√ß√£o de Entrada na Sala -->
    <div class="section" id="join-section">
      <div class="game-rules">
        <h4>üìã Como Jogar:</h4>
        <p>‚Ä¢ Cada jogador cria uma sequ√™ncia de 5 palavras relacionadas<br>
        ‚Ä¢ Voc√™ vai tentar descobrir a sequ√™ncia do seu oponente<br>
        ‚Ä¢ Acertou? Continue jogando! Errou? Ganha mais uma letra e passa a vez<br>
        ‚Ä¢ Vence quem descobrir todas as 5 palavras primeiro!</p>
      </div>
      
      <label for="player-name">üßë‚Äçüíª Seu Nome:</label>
      <input type="text" id="player-name" placeholder="Digite seu nome" maxlength="20" />

      <label for="room-id">üè† C√≥digo da Sala:</label>
      <input type="text" id="room-id" placeholder="Deixe vazio para criar nova sala" maxlength="10" />

      <button onclick="joinRoom()">Entrar na Sala</button>
      
      <div id="error-join" class="error-message hidden"></div>
    </div>

    <!-- C√≥digo da Sala Criada -->
    <div class="section hidden" id="room-code-section">
      <div class="room-code">
        <strong>üéØ C√≥digo da Sala: <span id="current-room-code"></span></strong>
        <br><small>Compartilhe este c√≥digo com seu oponente!</small>
      </div>
    </div>

    <!-- Se√ß√£o de Escolha de Palavras -->
    <div class="section hidden" id="word-section">
      <h2>‚úçÔ∏è Escolha suas 5 palavras</h2>
      <p><strong>Importante:</strong> Crie uma sequ√™ncia onde cada palavra se relaciona com a anterior!</p>
      <p><em>Exemplo: Fogo ‚Üí Chama ‚Üí Vela ‚Üí Cera ‚Üí Abelha</em></p>
      
      <div id="word-inputs"></div>
      <button onclick="submitWords()" id="submit-words-btn">Enviar Palavras</button>
      
      <div id="error-words" class="error-message hidden"></div>
      <div id="waiting-message" class="success-message hidden"></div>
    </div>

    <!-- Se√ß√£o do Jogo -->
    <div class="section hidden" id="game-section">
      <div class="game-info">
        <div class="keyword" id="keyword-display"></div>
        <div class="turn-indicator" id="turn-info"></div>
        <div class="hints-container" id="hints-container"></div>
      </div>
      
      <label for="guess">üí≠ Seu Palpite:</label>
      <input type="text" id="guess" placeholder="Digite sua palavra" maxlength="50" />
      <button onclick="sendGuess()" id="guess-btn">Enviar Palpite</button>
      
      <div id="error-game" class="error-message hidden"></div>
    </div>

    <!-- Se√ß√£o de Jogadores -->
    <div class="section hidden" id="players-section">
      <h3>üë• Jogadores na Sala</h3>
      <div id="players"></div>
    </div>

    <!-- Se√ß√£o de Chat -->
    <div class="section hidden" id="chat-section">
      <h3>üí¨ Chat</h3>
      <div id="chat"></div>
      <input type="text" id="chat-message" placeholder="Digite sua mensagem" maxlength="200" />
      <button onclick="sendChat()">Enviar</button>
    </div>

    <!-- Se√ß√£o de Novo Jogo -->
    <div class="section hidden" id="new-game-section">
      <button onclick="startNewGame()">üîÑ Novo Jogo</button>
    </div>
  </div>

  <script>
    const socket = io();
    let playerName = '';
    let roomId = '';
    let currentWordIndex = 0;
    let isMyTurn = false;
    let gameStarted = false;

    // Conectar ao servidor
    socket.on("connect", () => {
      console.log("Conectado ao servidor");
    });

    // Fun√ß√£o para entrar na sala
    function joinRoom() {
      const nameInput = document.getElementById("player-name");
      const roomInput = document.getElementById("room-id");
      
      playerName = nameInput.value.trim();
      roomId = roomInput.value.trim();

      if (!playerName) {
        showError("error-join", "Por favor, digite seu nome!");
        return;
      }

      if (playerName.length < 2) {
        showError("error-join", "Nome deve ter pelo menos 2 caracteres!");
        return;
      }

      socket.emit("join_game", { 
        player_name: playerName, 
        room_id: roomId || null 
      });
    }

    // Criar inputs para as palavras
    function createWordInputs() {
      const wordInputs = document.getElementById("word-inputs");
      wordInputs.innerHTML = '';
      
      for (let i = 0; i < 5; i++) {
        const div = document.createElement("div");
        div.className = "word-input";
        
        const label = document.createElement("label");
        label.innerText = `Palavra ${i + 1}:`;
        
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Digite a palavra ${i + 1}`;
        input.id = `word-${i}`;
        input.maxLength = 50;
        
        div.appendChild(label);
        div.appendChild(input);
        wordInputs.appendChild(div);
      }
    }

    // Submeter palavras
    function submitWords() {
      const words = [];
      let hasError = false;
      
      for (let i = 0; i < 5; i++) {
        const word = document.getElementById(`word-${i}`).value.trim();
        if (!word) {
          showError("error-words", `Por favor, preencha a palavra ${i + 1}!`);
          hasError = true;
          break;
        }
        if (word.length < 2) {
          showError("error-words", `Palavra ${i + 1} deve ter pelo menos 2 caracteres!`);
          hasError = true;
          break;
        }
        words.push(word);
      }
      
      if (hasError) return;
      
      socket.emit("submit_words", { words });
      
      document.getElementById("submit-words-btn").disabled = true;
      showSuccess("waiting-message", "Palavras enviadas! Aguardando seu oponente...");
    }

    // Enviar palpite
    function sendGuess() {
      const guessInput = document.getElementById("guess");
      const guess = guessInput.value.trim();
      
      if (!guess) {
        showError("error-game", "Digite uma palavra!");
        return;
      }
      
      if (!isMyTurn) {
        showError("error-game", "N√£o √© sua vez!");
        return;
      }
      
      socket.emit("make_guess", { guess });
      guessInput.value = "";
      document.getElementById("guess-btn").disabled = true;
    }

    // Enviar mensagem no chat
    function sendChat() {
      const chatInput = document.getElementById("chat-message");
      const message = chatInput.value.trim();
      
      if (!message) return;
      
      socket.emit("chat_message", { message });
      chatInput.value = "";
    }

    // Iniciar novo jogo
    function startNewGame() {
      socket.emit("new_game");
    }

    // Event Listeners para Enter
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("player-name").addEventListener("keypress", (e) => {
        if (e.key === "Enter") joinRoom();
      });
      
      document.getElementById("room-id").addEventListener("keypress", (e) => {
        if (e.key === "Enter") joinRoom();
      });
      
      document.getElementById("guess").addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendGuess();
      });
      
      document.getElementById("chat-message").addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendChat();
      });
    });

    // Eventos do Socket
    socket.on("joined_room", (data) => {
      roomId = data.room_id;
      
      document.getElementById("join-section").classList.add("hidden");
      document.getElementById("room-code-section").classList.remove("hidden");
      document.getElementById("word-section").classList.remove("hidden");
      document.getElementById("players-section").classList.remove("hidden");
      document.getElementById("chat-section").classList.remove("hidden");
      
      document.getElementById("current-room-code").innerText = roomId;
      createWordInputs();
      hideError("error-join");
    });

    socket.on("players_update", (data) => {
      updatePlayersList(data.players_online);
    });

    socket.on("words_submitted", (data) => {
      if (data.waiting_for === 0) {
        showSuccess("waiting-message", "Ambos jogadores prontos! Iniciando jogo...");
      } else {
        showSuccess("waiting-message", `Aguardando ${data.waiting_for} jogador(es)...`);
      }
      updatePlayersList(data.players_online);
    });

    socket.on("game_started", (data) => {
      gameStarted = true;
      currentWordIndex = data.current_word_index || 0;
      isMyTurn = data.your_turn;
      
      document.getElementById("word-section").classList.add("hidden");
      document.getElementById("game-section").classList.remove("hidden");
      document.getElementById("new-game-section").classList.remove("hidden");
      
      // Mostrar palavra-chave
      document.getElementById("keyword-display").innerText = `Palavra-chave: ${data.keyword}`;
      
      // Mostrar dicas
      updateHints(data.hint_letters, currentWordIndex);
      
      // Atualizar turno
      updateTurnInfo(data.current_turn, isMyTurn);
      
      hideError("error-game");
    });

    socket.on("correct_guess", (data) => {
      currentWordIndex++;
      isMyTurn = data.continues_playing;
      
      updateTurnInfo(data.next_turn, isMyTurn);
      
      if (data.hint) {
        updateCurrentHint(data.hint, currentWordIndex);
      }
      
      document.getElementById("guess-btn").disabled = false;
      hideError("error-game");
    });

    socket.on("incorrect_guess", (data) => {
      isMyTurn = false;
      
      updateTurnInfo(data.next_turn, false);
      
      if (data.hint) {
        updateCurrentHint(data.hint, currentWordIndex);
      }
      
      document.getElementById("guess-btn").disabled = false;
      hideError("error-game");
    });

    socket.on("game_finished", (data) => {
      alert(`üéâ ${data.message}\n\nSequ√™ncia completa: ${data.completed_sequence ? data.completed_sequence.join(" ‚Üí ") : ""}`);
      gameStarted = false;
      isMyTurn = false;
    });

    socket.on("new_chat_message", (data) => {
      const chatBox = document.getElementById("chat");
      const messageDiv = document.createElement("div");
      messageDiv.className = "chat-message";
      messageDiv.innerHTML = `<strong>[${data.timestamp}] ${data.player_name}:</strong> ${data.message}`;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on("game_reset", (data) => {
      gameStarted = false;
      isMyTurn = false;
      currentWordIndex = 0;
      
      document.getElementById("game-section").classList.add("hidden");
      document.getElementById("word-section").classList.remove("hidden");
      document.getElementById("new-game-section").classList.add("hidden");
      
      document.getElementById("submit-words-btn").disabled = false;
      createWordInputs();
      hideError("error-words");
      hideSuccess("waiting-message");
      
      updatePlayersList(data.players_online);
    });

    socket.on("error", (data) => {
      if (gameStarted) {
        showError("error-game", data.message);
      } else {
        showError("error-join", data.message);
      }
    });

    // Fun√ß√µes auxiliares
    function updatePlayersList(players) {
      const playersList = document.getElementById("players");
      playersList.innerHTML = "";
      
      players.forEach(player => {
        const playerDiv = document.createElement("div");
        playerDiv.className = "player-item";
        
        if (player.is_current_turn) {
          playerDiv.classList.add("current-turn");
        }
        
        if (player.words_chosen) {
          playerDiv.classList.add("words-chosen");
        }
        
        const playerName = document.createElement("span");
        playerName.innerText = player.name;
        
        const statusSpan = document.createElement("span");
        statusSpan.className = "status-indicator";
        
        if (gameStarted && player.is_current_turn) {
          statusSpan.innerText = "Jogando";
          statusSpan.classList.add("status-playing");
        } else if (player.words_chosen) {
          statusSpan.innerText = "Pronto";
          statusSpan.classList.add("status-ready");
        } else {
          statusSpan.innerText = "Aguardando";
          statusSpan.classList.add("status-waiting");
        }
        
        playerDiv.appendChild(playerName);
        playerDiv.appendChild(statusSpan);
        playersList.appendChild(playerDiv);
      });
    }

    function updateHints(hints, currentIndex) {
      const hintsContainer = document.getElementById("hints-container");
      hintsContainer.innerHTML = "";
      
      hints.forEach((hint, index) => {
        const hintDiv = document.createElement("div");
        hintDiv.className = "hint-word";
        hintDiv.innerText = hint;
        
        if (index === currentIndex) {
          hintDiv.classList.add("current");
        } else if (index < currentIndex) {
          hintDiv.classList.add("completed");
        }
        
        hintsContainer.appendChild(hintDiv);
      });
    }

    function updateCurrentHint(hint, wordIndex) {
      const hintWords = document.querySelectorAll(".hint-word");
      if (hintWords[wordIndex]) {
        hintWords[wordIndex].innerText = hint;
      }
    }

    function updateTurnInfo(currentTurn, isMyTurn) {
      const turnInfo = document.getElementById("turn-info");
      const guessBtn = document.getElementById("guess-btn");
      
      if (isMyTurn) {
        turnInfo.innerHTML = `<span class="your-turn">üéØ Sua vez!</span>`;
        guessBtn.disabled = false;
      } else {
        turnInfo.innerHTML = `<span class="opponent-turn">‚è≥ Vez de: ${currentTurn}</span>`;
        guessBtn.disabled = true;
      }
    }

    function showError(elementId, message) {
      const errorDiv = document.getElementById(elementId);
      errorDiv.innerText = message;
      errorDiv.classList.remove("hidden");
    }

    function hideError(elementId) {
      document.getElementById(elementId).classList.add("hidden");
    }

    function showSuccess(elementId, message) {
      const successDiv = document.getElementById(elementId);
      successDiv.innerText = message;
      successDiv.classList.remove("hidden");
    }

    function hideSuccess(elementId) {
      document.getElementById(elementId).classList.add("hidden");
    }
  </script>
</body>
</html>
